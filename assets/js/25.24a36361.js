(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{210:function(e,o,s){"use strict";s.r(o);var t=s(0),r=Object(t.a)({},(function(){var e=this,o=e.$createElement,s=e._self._c||o;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("p",[e._v("首先理清cookie和session。因为我的博客有登录功能所以用到了cookie，但是因为cookie并不安全，业内的统一解决方案是引入session")]),e._v(" "),s("h2",{attrs:{id:"理解cookie（headers）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#理解cookie（headers）","aria-hidden":"true"}},[e._v("#")]),e._v(" 理解Cookie（headers）")]),e._v(" "),s("p",[e._v("cookie是存储在浏览器的一串字符串 (最大5kb)\ncookie有跨域不共享的特性，浏览器为每个域名分别存储一段域名\ncookie的格式如 K1-v1;K2=v2;K3=v3; 因此可以存储结构化数据")]),e._v(" "),s("p",[e._v("每次发送http请求，会将请求域的cookie一起发送给server\nserver端可以修改cookie并返回给浏览器\n浏览器（Client）也可以通过javaScrip修改cookie（有限制，可以在server端进行限制）")]),e._v(" "),s("p",[e._v("如下图\n"),s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190530135759613.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjI1NzMyOQ==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})]),e._v(" "),s("h2",{attrs:{id:"浏览器（client端）操作cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器（client端）操作cookie","aria-hidden":"true"}},[e._v("#")]),e._v(" 浏览器（Client端）操作cookie")]),e._v(" "),s("p",[e._v("以chrome为例\n"),s("strong",[e._v("查看cookie")]),s("br"),e._v("\n未解析的：network  > ALL > headers   "),s("strong",[e._v("responseheaders")]),e._v(" "),s("strong",[e._v("requestheaders")]),e._v("\n解析后的：Application > Storage > Cookies "),s("strong",[e._v("Name")]),e._v(" cookie的名字，Value：cookie的值，Domain：cookie生效的域名，path：cookie生效的路径，expires：cookie的有效期，size：cookie的大小")]),e._v(" "),s("p",[s("strong",[e._v("用js修改cookie 在浏览器控制台中，Console中")]),e._v("\n查看cookies：document.cookie\n累加cookies：document.cookie='K2=v1'\n并不能修改删除，只能累加")]),e._v(" "),s("h3",{attrs:{id:"server端操作cookie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#server端操作cookie","aria-hidden":"true"}},[e._v("#")]),e._v(" server端操作cookie")]),e._v(" "),s("p",[e._v("查看cookie\n修改cookie\n两者就可以实现登录验证")]),e._v(" "),s("p",[s("strong",[e._v("解析cookie")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("//解析cookies\n    req.cookie = {} //定义一个req.cookies为空值\n    const cookieStr = req.headers.cookie || ''\n    cookieStr.split(';').forEach(item => { //通过分号拆分数组，并进行遍历\n        if(!item) { //如果item的值不存在\n            return //return结束，return是终止符\n        }\n        const arr = item.split('=') //通过等号把K1=V1拆分成数组\n        const key = arr[0].trim() //key是等号前面那个值\n        const val = arr[1].trim() //val是等号后面那个值\n        req.cookie[key] = val  //把key的值赋值为val\n    })\n    console.log('req.cookie is',req.cookie)  // {name:lisi}\n")])])]),s("p",[s("strong",[e._v("操作cookie")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("res.setHeader('set-Cookie',`userid=${userId};path=/;httpOnly;expires=${getCookieExpires()}`)\n//path=/：设置生效路径为根目录\n//httpOnly: 设置只允许后端修改\n//expires=:设置生效时间期限\n")])])]),s("p",[e._v(".\n.")]),e._v(" "),s("h2",{attrs:{id:"理解session"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#理解session","aria-hidden":"true"}},[e._v("#")]),e._v(" 理解session")]),e._v(" "),s("p",[e._v("sesion可以弥补cookie的缺陷\n单纯cookie的缺陷")]),e._v(" "),s("blockquote",[s("p",[e._v("会暴露信息（如用户名，登录密码） 非常危险")])]),e._v(" "),s("p",[e._v("解决办法：")]),e._v(" "),s("blockquote",[s("p",[e._v("server端的session存储用户信息，cookie只存储userid来到session中取用\n如cookie 》userid， server》username")])]),e._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190530144643951.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjI1NzMyOQ==,size_16,color_FFFFFF,t_70",alt:"在这里插入图片描述"}})]),e._v(" "),s("pre",[s("code",[e._v(" //设置sesson空对象\n const SESSION_DATA= {}\n //解析session\n let needSetCookie = false //默认判断需要验证\n let userId = req.cookie.userid\n if(userId){\n     if(!SESSION_DATA[userId]) {//如果SESSION_DATA没有这个userid就初始化一个对象\n         SESSION_DATA[userId] = {}\n     }\n     } else{\n        needSetCookie = true\n         userId= `${Date.now()}_${Math.random()}`\n         SESSION_DATA[userId] = {}\n     }\n     req.session = SESSION_DATA[userId]`\n")])]),e._v(" "),s("h2",{attrs:{id:"token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#token","aria-hidden":"true"}},[e._v("#")]),e._v(" Token")]),e._v(" "),s("blockquote",[s("p",[e._v("token一种新机制 因为cookie对于每个用户都需要在服务器端新建一个session 然后消耗大 反正很多坏处\ntoken就是把信息保存在用户端\n第一次登陆后服务器把用户信息通过特定算法加密生成一个token 然后结合用户信息和生成的信息统一返回给用户 用户存储 下次用户访问带上这个token 然后服务器只是需要把token里面的签名用算法解密,确认token里面的用户信息是否符合。 符合的就返回相应信息 并且继续返回token token过期之后服务器刷新一下啥的就行")])]),e._v(" "),s("p",[e._v("大致整理了一下，后续可能还会再丰富修改")])])}),[],!1,null,null,null);o.default=r.exports}}]);